<div class="certificate-list-container">
  <mat-card class="certificate-list-card">
    <mat-card-header class="card-header">
      <mat-card-title>Certificate Management</mat-card-title>
      <div class="header-actions">
        <button mat-button (click)="exportToExcel()" class="export-button">
          <mat-icon>file_download</mat-icon>
          Export Excel
        </button>
        <button mat-raised-button color="primary" (click)="createCertificate()" class="create-button">
          <mat-icon>add</mat-icon>
          Create Certificate
        </button>
      </div>
    </mat-card-header>

    <mat-card-content>
      <div class="filters-section">
        <mat-form-field class="search-field" appearance="outline">
          <mat-label>Search certificates</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Search by certificate number, name, or employer">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field class="filter-field" appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select [(value)]="statusFilter" (selectionChange)="onStatusFilter()">
            <mat-option value="">All Statuses</mat-option>
            <mat-option *ngFor="let status of statuses" [value]="status">{{ status }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="table-container">
        <table mat-table [dataSource]="filteredCertificates" class="certificate-table">

          <ng-container matColumnDef="certificate_number">
            <th mat-header-cell *matHeaderCellDef>Certificate Number</th>
            <td mat-cell *matCellDef="let certificate">
              <strong class="cert-number">{{ certificate.certificate_number }}</strong>
            </td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let certificate">
              <div class="name-info">
                <div class="name">{{ certificate.name }}</div>
                <div class="nationality">{{ certificate.nationality }}</div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="employer">
            <th mat-header-cell *matHeaderCellDef>Employer</th>
            <td mat-cell *matCellDef="let certificate">{{ certificate.employer }}</td>
          </ng-container>

          <ng-container matColumnDef="training_name">
            <th mat-header-cell *matHeaderCellDef>Training</th>
            <td mat-cell *matCellDef="let certificate">{{ certificate.training_name }}</td>
          </ng-container>

          <ng-container matColumnDef="issue_date">
            <th mat-header-cell *matHeaderCellDef>Issue Date</th>
            <td mat-cell *matCellDef="let certificate">{{ certificate.issue_date | date:'mediumDate' }}</td>
          </ng-container>

          <ng-container matColumnDef="due_date">
            <th mat-header-cell *matHeaderCellDef>Due Date</th>
            <td mat-cell *matCellDef="let certificate">{{ certificate.due_date | date:'mediumDate' }}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let certificate">
              <mat-chip [class]="'status-chip status-' + getStatusClass(certificate.status)">
                {{ certificate.status }}
              </mat-chip>
            </td>
          </ng-container>

          <ng-container matColumnDef="attachments">
            <th mat-header-cell *matHeaderCellDef>Attachments</th>
            <td mat-cell *matCellDef="let certificate">
              <div class="attachment-icons">
                <mat-icon *ngIf="hasAttachment(certificate, AttachmentType.EID)" class="attachment-icon eid-icon"
                  title="EID Available" (click)="downloadAttachment(certificate, AttachmentType.EID)">
                  credit_card
                </mat-icon>
                <mat-icon *ngIf="hasAttachment(certificate, AttachmentType.DRIVING_LICENSE)"
                  class="attachment-icon license-icon" title="License Available"
                  (click)="downloadAttachment(certificate, AttachmentType.DRIVING_LICENSE)">
                  drive_eta
                </mat-icon>
                <mat-icon *ngIf="hasAttachment(certificate, AttachmentType.SIGNED_CERTIFICATE)"
                  class="attachment-icon signed-icon" title="Signed Certificate"
                  (click)="downloadAttachment(certificate, AttachmentType.SIGNED_CERTIFICATE)">
                  fact_check
                </mat-icon>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let certificate">
              <button mat-icon-button [matMenuTriggerFor]="actionMenu" title="Actions">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #actionMenu="matMenu">
                <button mat-menu-item (click)="editCertificate(certificate)">
                  <mat-icon>edit</mat-icon>
                  <span>Edit</span>
                </button>
                <button mat-menu-item (click)="previewCertificate(certificate)">
                  <mat-icon>visibility</mat-icon>
                  <span>Preview</span>
                </button>
                <button mat-menu-item (click)="exportToPdf(certificate, 'pdf')">
                  <mat-icon>picture_as_pdf</mat-icon>
                  <span>Export PDF</span>
                </button>
                <button mat-menu-item (click)="exportToPdf(certificate, 'docx')">
                  <mat-icon>description</mat-icon>
                  <span>Export Word</span>
                </button>
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</div>